#!/bin/bash
# .xprofile - runs before window manager starts
# Sets environment variables for the entire X session

# Add mise shims to PATH for all GUI applications (editors, terminals, etc.)
export PATH="$HOME/.local/share/mise/shims:$PATH"

# Source master scaling system and apply all settings at boot
if [ -f ~/.config/i3/scripts/scaling.sh ]; then
    source ~/.config/i3/scripts/scaling.sh
    
    # Apply X11 settings immediately (critical for consistent boot scaling)
    xrdb -merge ~/.Xresources 2>/dev/null || true
    xrandr --dpi "$DPI" 2>/dev/null || true
    
    # Apply gsettings for GTK apps
    gsettings set org.gnome.desktop.interface text-scaling-factor "$SCALE" 2>/dev/null || true
    gsettings set org.gnome.desktop.interface cursor-size "$CURSOR_SIZE" 2>/dev/null || true
    gsettings set org.gnome.desktop.interface cursor-theme 'Breeze' 2>/dev/null || true
else
    # Fallback if scaling.sh doesn't exist (match default 150% scaling)
    export QT_AUTO_SCREEN_SCALE_FACTOR=0
    export ELECTRON_FORCE_IS_PACKAGED=1
    xrandr --dpi 144 2>/dev/null || true
fi
